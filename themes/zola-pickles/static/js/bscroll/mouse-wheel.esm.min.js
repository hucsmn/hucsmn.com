/*!
 * better-scroll / mouse-wheel
 * (c) 2016-2021 ustbhuangyi
 * Released under the MIT License.
 */
function warn(e){console.error("[BScroll warn]: "+e)}var inBrowser="undefined"!=typeof window,ua=inBrowser&&navigator.userAgent.toLowerCase(),isWeChatDevTools=!(!ua||!/wechatdevtools/.test(ua)),isAndroid=ua&&ua.indexOf("android")>0,isIOSBadVersion=function(){if("string"==typeof ua){var e=/os (\d\d?_\d(_\d)?)/.exec(ua);if(!e)return!1;var t=e[1].split("_").map((function(e){return parseInt(e,10)}));return!!(13===t[0]&&t[1]>=4)}return!1}(),supportsPassive=!1;if(inBrowser){var EventName="test-passive";try{var opts={};Object.defineProperty(opts,"passive",{get:function(){supportsPassive=!0}}),window.addEventListener(EventName,(function(){}),opts)}catch(e){}}var extend=function(e,t){for(var r in t)e[r]=t[r];return e},elementStyle=inBrowser&&document.createElement("div").style,vendor=function(){if(!inBrowser)return!1;for(var e=0,t=[{key:"standard",value:"transform"},{key:"webkit",value:"webkitTransform"},{key:"Moz",value:"MozTransform"},{key:"O",value:"OTransform"},{key:"ms",value:"msTransform"}];e<t.length;e++){var r=t[e];if(void 0!==elementStyle[r.value])return r.key}return!1}();function prefixStyle(e){return!1===vendor?e:"standard"===vendor?"transitionEnd"===e?"transitionend":e:vendor+e.charAt(0).toUpperCase()+e.substr(1)}function addEvent(e,t,r,i){var n=supportsPassive?{passive:!1,capture:!!i}:!!i;e.addEventListener(t,r,n)}function removeEvent(e,t,r,i){e.removeEventListener(t,r,{capture:!!i})}var cssVendor=vendor&&"standard"!==vendor?"-"+vendor.toLowerCase()+"-":"",transform=prefixStyle("transform"),transition=prefixStyle("transition"),hasPerspective=inBrowser&&prefixStyle("perspective")in elementStyle,style={transform:transform,transition:transition,transitionTimingFunction:prefixStyle("transitionTimingFunction"),transitionDuration:prefixStyle("transitionDuration"),transitionDelay:prefixStyle("transitionDelay"),transformOrigin:prefixStyle("transformOrigin"),transitionEnd:prefixStyle("transitionEnd"),transitionProperty:prefixStyle("transitionProperty")};function preventDefaultExceptionFn(e,t){for(var r in t)if(t[r].test(e[r]))return!0;return!1}var EventRegister=function(){function e(e,t){this.wrapper=e,this.events=t,this.addDOMEvents()}return e.prototype.destroy=function(){this.removeDOMEvents(),this.events=[]},e.prototype.addDOMEvents=function(){this.handleDOMEvents(addEvent)},e.prototype.removeDOMEvents=function(){this.handleDOMEvents(removeEvent)},e.prototype.handleDOMEvents=function(e){var t=this,r=this.wrapper;this.events.forEach((function(i){e(r,i.name,t,!!i.capture)}))},e.prototype.handleEvent=function(e){var t=e.type;this.events.some((function(r){return r.name===t&&(r.handler(e),!0)}))},e}(),MouseWheel=function(){function e(e){this.scroll=e,this.wheelEndTimer=0,this.wheelMoveTimer=0,this.wheelStart=!1,this.init()}return e.prototype.init=function(){this.handleBScroll(),this.handleOptions(),this.handleHooks(),this.registerEvent()},e.prototype.handleBScroll=function(){this.scroll.registerType(["alterOptions","mousewheelStart","mousewheelMove","mousewheelEnd"])},e.prototype.handleOptions=function(){var e=!0===this.scroll.options.mouseWheel?{}:this.scroll.options.mouseWheel;this.mouseWheelOpt=extend({speed:20,invert:!1,easeTime:300,discreteTime:400,throttleTime:0,dampingFactor:.1},e)},e.prototype.handleHooks=function(){this.hooksFn=[],this.registerHooks(this.scroll.hooks,"destroy",this.destroy)},e.prototype.registerEvent=function(){this.eventRegister=new EventRegister(this.scroll.scroller.wrapper,[{name:"wheel",handler:this.wheelHandler.bind(this)},{name:"mousewheel",handler:this.wheelHandler.bind(this)},{name:"DOMMouseScroll",handler:this.wheelHandler.bind(this)}])},e.prototype.registerHooks=function(e,t,r){e.on(t,r,this),this.hooksFn.push([e,t,r])},e.prototype.wheelHandler=function(e){if(this.scroll.enabled){this.beforeHandler(e),this.wheelStart||(this.wheelStartHandler(e),this.wheelStart=!0);var t=this.getWheelDelta(e);this.wheelMoveHandler(t),this.wheelEndDetector(t)}},e.prototype.wheelStartHandler=function(e){this.cleanCache();var t=this.scroll.scroller,r=t.scrollBehaviorX,i=t.scrollBehaviorY;r.setMovingDirection(0),i.setMovingDirection(0),r.setDirection(0),i.setDirection(0),this.scroll.trigger(this.scroll.eventTypes.alterOptions,this.mouseWheelOpt),this.scroll.trigger(this.scroll.eventTypes.mousewheelStart)},e.prototype.cleanCache=function(){this.deltaCache=[]},e.prototype.wheelMoveHandler=function(e){var t=this,r=this.mouseWheelOpt,i=r.throttleTime,n=r.dampingFactor;if(i&&this.wheelMoveTimer)this.deltaCache.push(e);else{var o=this.deltaCache.reduce((function(e,t){return{x:e.x+t.x,y:e.y+t.y}}),{x:0,y:0});this.cleanCache();var s=this.scroll.scroller,a=s.scrollBehaviorX,l=s.scrollBehaviorY;a.setMovingDirection(-e.directionX),l.setMovingDirection(-e.directionY),a.setDirection(e.x),l.setDirection(e.y);var h=a.performDampingAlgorithm(Math.round(e.x)+o.x,n),c=l.performDampingAlgorithm(Math.round(e.y)+o.x,n);if(!this.scroll.trigger(this.scroll.eventTypes.mousewheelMove,{x:h,y:c})){var p=this.getEaseTime();h===this.scroll.x&&c===this.scroll.y||this.scroll.scrollTo(h,c,p)}i&&(this.wheelMoveTimer=window.setTimeout((function(){t.wheelMoveTimer=0}),i))}},e.prototype.wheelEndDetector=function(e){var t=this;window.clearTimeout(this.wheelEndTimer),this.wheelEndTimer=window.setTimeout((function(){t.wheelStart=!1,window.clearTimeout(t.wheelMoveTimer),t.wheelMoveTimer=0,t.scroll.trigger(t.scroll.eventTypes.mousewheelEnd,e)}),this.mouseWheelOpt.discreteTime)},e.prototype.getWheelDelta=function(e){var t=this.mouseWheelOpt,r=t.speed,i=0,n=0,o=t.invert?-1:1;switch(!0){case"deltaX"in e:1===e.deltaMode?(i=-e.deltaX*r,n=-e.deltaY*r):(i=-e.deltaX,n=-e.deltaY);break;case"wheelDeltaX"in e:i=e.wheelDeltaX/120*r,n=e.wheelDeltaY/120*r;break;case"wheelDelta"in e:i=n=e.wheelDelta/120*r;break;case"detail"in e:i=n=-e.detail/3*r}return i*=o,n*=o,this.scroll.hasVerticalScroll||(i=n,n=0),this.scroll.hasHorizontalScroll||(i=0),{x:i,y:n,directionX:i>0?-1:i<0?1:0,directionY:n>0?-1:n<0?1:0}},e.prototype.beforeHandler=function(e){var t=this.scroll.options,r=t.preventDefault,i=t.stopPropagation,n=t.preventDefaultException;r&&!preventDefaultExceptionFn(e.target,n)&&e.preventDefault(),i&&e.stopPropagation()},e.prototype.getEaseTime=function(){var e=this.mouseWheelOpt.easeTime;return e<100&&warn("easeTime should be greater than 100.If mouseWheel easeTime is too small,scrollEnd will be triggered many times."),Math.max(e,100)},e.prototype.destroy=function(){this.eventRegister.destroy(),window.clearTimeout(this.wheelEndTimer),window.clearTimeout(this.wheelMoveTimer),this.hooksFn.forEach((function(e){var t=e[0],r=e[1],i=e[2];t.off(r,i)}))},e.pluginName="mouseWheel",e.applyOrder="pre",e}();export default MouseWheel;